{"ast":null,"code":"import { FormGroup, FormControl } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./user-infos.service\";\nimport * as i2 from \"../themes/themes.service\";\nimport * as i3 from \"../langs/langs.service\";\nimport * as i4 from \"../users/users.service\";\nimport * as i5 from \"@ng-bootstrap/ng-bootstrap\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"../base-table/base.table.component\";\nimport * as i8 from \"@angular/forms\";\nimport * as i9 from \"../base-field-edit/base.field.edit.component\";\nconst _c0 = [\"baseTable\"];\n\nfunction UserInfosComponent_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 8);\n  }\n}\n\nfunction UserInfosComponent_ng_template_10_ng_container_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 18);\n    i0.ɵɵelementStart(2, \"span\", 19);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r5.addError);\n  }\n}\n\nfunction UserInfosComponent_ng_template_10_ng_container_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"form\", 20);\n    i0.ɵɵelementStart(2, \"div\", 21);\n    i0.ɵɵelementStart(3, \"div\", 22);\n    i0.ɵɵelementStart(4, \"div\", 15);\n    i0.ɵɵelementStart(5, \"span\", 23);\n    i0.ɵɵtext(6, \"user ID\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 15);\n    i0.ɵɵelement(8, \"base-field-edit\", 24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r6.modalForm);\n    i0.ɵɵadvance(3);\n    i0.ɵɵstyleProp(\"width\", \"30%\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵstyleProp(\"width\", \"70%\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"type\", \"select\")(\"fn\", ctx_r6.editReceiveFn)(\"control\", ctx_r6.modalForm.get(\"userId\"));\n  }\n}\n\nfunction UserInfosComponent_ng_template_10_ng_container_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 25);\n    i0.ɵɵelementStart(2, \"div\", 26);\n    i0.ɵɵelementStart(3, \"span\", 27);\n    i0.ɵɵtext(4, \"Loading...\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\n\nfunction UserInfosComponent_ng_template_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵelementStart(1, \"div\");\n    i0.ɵɵelementStart(2, \"h4\", 10);\n    i0.ɵɵtext(3, \"Create User Info\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\");\n    i0.ɵɵelementStart(5, \"a\", 11);\n    i0.ɵɵlistener(\"click\", function UserInfosComponent_ng_template_10_Template_a_click_5_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const modal_r4 = restoredCtx.$implicit;\n      $event.preventDefault();\n      return modal_r4.dismiss(\"close\");\n    });\n    i0.ɵɵelementStart(6, \"span\");\n    i0.ɵɵtext(7, \"\\u00D7\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 12);\n    i0.ɵɵtemplate(9, UserInfosComponent_ng_template_10_ng_container_9_Template, 4, 1, \"ng-container\", 13);\n    i0.ɵɵtemplate(10, UserInfosComponent_ng_template_10_ng_container_10_Template, 9, 8, \"ng-container\", 13);\n    i0.ɵɵtemplate(11, UserInfosComponent_ng_template_10_ng_container_11_Template, 5, 0, \"ng-container\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 14);\n    i0.ɵɵelementStart(13, \"div\", 15);\n    i0.ɵɵelementStart(14, \"a\", 16);\n    i0.ɵɵlistener(\"click\", function UserInfosComponent_ng_template_10_Template_a_click_14_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r9);\n      const modal_r4 = restoredCtx.$implicit;\n      $event.preventDefault();\n      return modal_r4.dismiss(\"cancel\");\n    });\n    i0.ɵɵtext(15, \"Cancel\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"div\", 15);\n    i0.ɵɵelementStart(17, \"a\", 17);\n    i0.ɵɵlistener(\"click\", function UserInfosComponent_ng_template_10_Template_a_click_17_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.onModalCreate($event);\n    });\n    i0.ɵɵtext(18, \"Save\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.addError);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r3.addProcess);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.addProcess);\n  }\n}\n\nexport let UserInfosComponent = /*#__PURE__*/(() => {\n  class UserInfosComponent {\n    constructor(userInfosService, themesService, langsService, usersService, modalService) {\n      this.userInfosService = userInfosService;\n      this.themesService = themesService;\n      this.langsService = langsService;\n      this.usersService = usersService;\n      this.modalService = modalService;\n      this.querys = [{\n        namespace: 'gets',\n        method: 'GET',\n        success: data => this.baseTable.injectData(data)\n      }, {\n        namespace: 'edit',\n        method: 'POST',\n        success: data => this.baseTable.patchData(data),\n        error: e => this.baseTable.filterError(e)\n      }, {\n        namespace: 'remove',\n        method: 'POST',\n        success: data => this.baseTable.patchData(data),\n        error: e => this.baseTable.filterError(e)\n      }, {\n        namespace: 'delete',\n        method: 'POST',\n        success: data => this.baseTable.filterData(data),\n        error: e => this.baseTable.filterError(e)\n      }, {\n        namespace: 'add',\n        method: 'POST',\n        success: data => {\n          this.baseTable.injectOneData(data);\n          this.addProcess = false;\n          this.addModalRef.close();\n        },\n        error: e => {\n          this.addError = e.error.reason;\n          this.addProcess = false;\n        }\n      }];\n      this.fields = [{\n        name: \"id\",\n        title: \"id\",\n        width: 5\n      }, {\n        name: \"user\",\n        title: \"user\",\n        width: 20,\n        viewFn: entry => {\n          let datas = [];\n          if (entry.user) datas.push(entry.user);\n          if (entry.social_id) datas.push(entry.social_id);\n          return datas.join('/');\n        }\n      }, {\n        name: \"first_name\",\n        title: \"name\",\n        width: 15,\n        editTitle: 'first name',\n        editType: 'input',\n        formControlName: 'first_name'\n      }, {\n        name: \"last_name\",\n        title: \"family\",\n        width: 15,\n        editTitle: 'last name',\n        editType: 'input',\n        formControlName: 'last_name'\n      }, {\n        name: \"lang\",\n        title: \"lang\",\n        width: 10,\n        editTitle: 'lang user',\n        editType: 'select',\n        formControlName: 'lang',\n        viewFn: data => {\n          return data.title;\n        },\n        editFn: data => {\n          return data.id;\n        },\n        editReceiveFn: () => {\n          return new Promise((res, rej) => {\n            let obs = this.langsService.source('short-gets', 'GET').subscribe(data => {\n              obs.unsubscribe();\n              res(data.map(entry => {\n                return {\n                  value: entry.id,\n                  title: entry.title\n                };\n              }));\n            });\n            this.langsService.get('short-gets');\n          });\n        }\n      }, {\n        name: \"theme\",\n        title: \"theme\",\n        width: 10,\n        editTitle: 'theme user',\n        editType: 'select',\n        formControlName: 'theme',\n        viewFn: data => {\n          return data.title;\n        },\n        editFn: data => {\n          return data.id;\n        },\n        editReceiveFn: () => {\n          return new Promise((res, rej) => {\n            let obs = this.themesService.source('short-gets', 'GET').subscribe(data => {\n              obs.unsubscribe();\n              res(data.map(entry => {\n                return {\n                  value: entry.id,\n                  title: entry.title\n                };\n              }));\n            });\n            this.themesService.get('short-gets');\n          });\n        }\n      }]; //////////////////////////////////////////////////////\n\n      this.editReceiveFn = () => {\n        return new Promise((res, rej) => {\n          let obs = this.usersService.source('short-gets', 'GET').subscribe(data => {\n            obs.unsubscribe();\n            res(data.map(entry => {\n              let datas = [];\n              if (entry.user) datas.push(entry.user);\n              if (entry.social_id) datas.push(entry.social_id);\n              return {\n                value: entry.id,\n                title: datas.join(' / ')\n              };\n            }));\n          });\n          this.usersService.get('short-gets');\n        });\n      };\n\n      this.addProcess = false;\n      this.modalForm = new FormGroup({\n        userId: new FormControl('')\n      });\n      this.addError = '';\n      this.service = this.userInfosService;\n    }\n\n    ngAfterViewInit() {\n      this.baseTable.refreshSettings();\n    }\n\n    onCreate(e, modal) {\n      e.preventDefault();\n      const modalRef = this.modalService.open(modal, {\n        size: 'lg'\n      });\n      modalRef.result.then(result => {}, reason => {\n        this.addError = '';\n      });\n      this.addModalRef = modalRef;\n      this.modalForm.controls.userId.setValue(null);\n    }\n\n    onModalCreate(e) {\n      e.preventDefault();\n\n      if (this.modalForm.valid) {\n        this.service.post('add', {\n          userId: this.modalForm.controls.userId.value\n        });\n        this.addProcess = true;\n        this.addError = '';\n      }\n    }\n\n  }\n\n  UserInfosComponent.ɵfac = function UserInfosComponent_Factory(t) {\n    return new (t || UserInfosComponent)(i0.ɵɵdirectiveInject(i1.UserInfosService), i0.ɵɵdirectiveInject(i2.ThemesService), i0.ɵɵdirectiveInject(i3.LangsService), i0.ɵɵdirectiveInject(i4.UsersService), i0.ɵɵdirectiveInject(i5.NgbModal));\n  };\n\n  UserInfosComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UserInfosComponent,\n    selectors: [[\"user-infos\"]],\n    viewQuery: function UserInfosComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.baseTable = _t.first);\n      }\n    },\n    decls: 12,\n    vars: 8,\n    consts: [[1, \"container-md\"], [1, \"row\", \"align-items-center\", \"justify-content-end\"], [1, \"col-auto\", \"align-self-end\"], [\"type\", \"button\", 1, \"btn\", \"btn-success\", 3, \"disabled\", \"click\"], [\"class\", \"spinner-border spinner-border-sm\", \"role\", \"status\", \"aria-hidden\", \"true\", 4, \"ngIf\"], [3, \"fields\", \"querys\", \"service\", \"isEdit\", \"isCreate\", \"isMore\"], [\"baseTable\", \"\"], [\"modal_create\", \"\"], [\"role\", \"status\", \"aria-hidden\", \"true\", 1, \"spinner-border\", \"spinner-border-sm\"], [1, \"modal-header\"], [\"id\", \"modal-basic-title\", 1, \"modal-title\"], [\"href\", \"#\", 1, \"btn\", \"btn-danger\", \"text-decoration-none\", 3, \"click\"], [1, \"modal-body\"], [4, \"ngIf\"], [1, \"modal-footer\", \"justify-content-center\"], [1, \"col-auto\"], [\"href\", \"#\", 1, \"btn\", \"btn-secondary\", \"text-decoration-none\", 3, \"click\"], [\"href\", \"#\", 1, \"btn\", \"btn-success\", \"text-decoration-none\", 3, \"click\"], [1, \"alert\", \"alert-danger\"], [1, \"h3\"], [1, \"container-fluid\", 3, \"formGroup\"], [1, \"row\", \"row-cols-1\"], [1, \"col\", \"row\", \"mt-1\", \"mb-1\", \"align-items-center\"], [1, \"h6\"], [3, \"type\", \"fn\", \"control\"], [1, \"row\", \"justify-content-center\"], [\"role\", \"status\", 1, \"col-auto\", \"spinner-border\", 2, \"width\", \"5rem\", \"height\", \"5rem\"], [1, \"sr-only\"]],\n    template: function UserInfosComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r12 = i0.ɵɵgetCurrentView();\n\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"span\");\n        i0.ɵɵelementStart(4, \"button\", 3);\n        i0.ɵɵlistener(\"click\", function UserInfosComponent_Template_button_click_4_listener($event) {\n          i0.ɵɵrestoreView(_r12);\n\n          const _r2 = i0.ɵɵreference(11);\n\n          return ctx.onCreate($event, _r2);\n        });\n        i0.ɵɵtemplate(5, UserInfosComponent_span_5_Template, 1, 0, \"span\", 4);\n        i0.ɵɵelementStart(6, \"span\");\n        i0.ɵɵtext(7, \"create\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(8, \"base-table\", 5, 6);\n        i0.ɵɵtemplate(10, UserInfosComponent_ng_template_10_Template, 19, 3, \"ng-template\", null, 7, i0.ɵɵtemplateRefExtractor);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"disabled\", ctx.addProcess);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.addProcess);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"fields\", ctx.fields)(\"querys\", ctx.querys)(\"service\", ctx.service)(\"isEdit\", true)(\"isCreate\", false)(\"isMore\", true);\n      }\n    },\n    directives: [i6.NgIf, i7.BaseTableComponent, i8.ɵNgNoValidate, i8.NgControlStatusGroup, i8.FormGroupDirective, i9.BaseFieldEditComponent],\n    encapsulation: 2\n  });\n  return UserInfosComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}